{% extends "base.html" %}

{% block title %}User Dashboard{% endblock %}

{% block content %}
    <h1 class="mb-4">User Dashboard</h1>
    <p>Welcome, {{current_user.fullname}}! Here you can manage your parking.</p>
    
    <div class="row">
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    Your Current Parking Status
                </div>
                <div class="card-body">
                    {% set current_spot=current_user.user_occupied_spot %}

                    {% if current_spot %}
                        {% if current_spot.status=='reserved' %}
                            <p>You have reserved spot <strong>{{current_spot.spot_number}}</strong> in <strong>{{current_spot.parking_lot.prime_location_name}}</strong>.</p>
                            <p>Status: <span class="badge bg-warning text-dark">Reserved</span></p>
                            <p>Ready to park?</p>
                            <form action="{{url_for('occupy_spot',spot_id=current_spot.id)}}" method="POST" style="display:inline;">
                                <button type='submit' class="btn btn-success me-2">Occupy Spot</button>
                            </form>
                            <button class="btn btn-secondary" disabled>Cancel Reservation</button>
                        {% elif current_spot.status=='occupied' %}
                            <p>You are currently occupying spot <strong>{{current_spot.spot_number}}</strong> in <strong>{{current_spot.parking_lot.prime_location_name}}</strong>.</p>
                            <p>Status: <span class="badge bg-danger">Occupied</span></p>
                            <form action="{{ url_for('release_spot', spot_id=current_spot.id) }}" method="POST" style="display:inline;" onsubmit="return confirm('Are you sure you want to release spot {{ current_spot.spot_number }}?');">
                                <button type="submit" class="btn btn-danger">Release Spot</button>
                            </form>
                        {% else %}
                            <p>You have a spot assigned with an unexpected status: {{current_spot.status}}.</p>
                        {% endif %}
                    {% else %}
                            <p>You do not currently have any reserved or occupied parking spots.</p>
                            <a href="{{url_for('user_view_parking_lots')}}" class="btn btn-info">Find Available Parking</a>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header bg-info text-white">
                    Quick Actions
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">
                            <a href="{{url_for('user_view_parking_lots')}}" class="btn btn-link">View Available Parking Lots</a>
                        </li>
                        <li class="list-group-item">
                            <a href="{{url_for('user_parking_history')}}" class="btn btn-link">View Parking History</a>
                        </li>
                        <li class="list-group-item">
                            <a href="{{url_for('logout')}}" class="btn btn-link text-danger">Logout</a>
                        </li>
                    </ul>
                </div>
            </div>

        </div>
    </div>
{% endblock %}